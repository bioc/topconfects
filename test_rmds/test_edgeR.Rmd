---
title: Test edgeR-based routines
---

```{r}
set.seed(1234)

library(tidyverse)
library(edgeR)
devtools::load_all("..")

n <- 100
folds <- seq(-2,2,length.out=n)
row_means <- runif(n, min=0, max=5)
lib_scale <- c(1,2,3,4)
means <- 2^(outer(folds, c(-1,-1,1,1))) * row_means * rep(lib_scale,each=n)
counts <- rnbinom(length(means), mu=means, size=1/0.1)
dim(counts) <- dim(means) 

counts
colSums(counts)

design <- cbind(c(1,1,0,0), c(0,0,1,1))

y <- DGEList(counts) %>%
    calcNormFactors() %>%
    estimateDisp(design)

fit <- glmQLFit(y, design)

fit$df.prior

confects <- edger_confects(fit, contrast=c(-1,1))
confects

confects$table
```

